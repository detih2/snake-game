# Hotfix: Бонусы и Лидерборд

**Дата:** 2026-01-26

## Изменения

### 1. Увеличена частота появления бонусов

**Проблема:** Бонусные звёздочки появлялись слишком редко (15% шанс при съедании еды).

**Решение:** Бонусы теперь появляются **после каждых 2 съеденных обычных еды** вместо случайного шанса.

**Изменённые файлы:**
- `frontend/src/hooks/useGame.js`

**Детали реализации:**
- Заменена константа `BONUS_CHANCE = 0.15` на `BONUS_SPAWN_INTERVAL = 2`
- Добавлен счётчик `foodEatenCountRef` для отслеживания съеденной еды
- Бонус спавнится когда `foodEatenCount % 2 === 0`
- Счётчик сбрасывается при старте новой игры

### 2. Исправлена работа таблицы лидеров (CORS)

**Проблема:** Лидерборд мог не загружаться из-за ошибок CORS на production.

**Решение:** 
- Добавлены актуальные production URL в список разрешённых origins
- Добавлена поддержка regex для Vercel preview deployments

**Изменённые файлы:**
- `backend/settings.py`
- `backend/app/main.py`

**Детали реализации:**
- Добавлены URL:
  - `https://frontend-drab-ten-89.vercel.app`
  - `https://snakepromo.ru`
  - `https://www.snakepromo.ru`
- Добавлен `allow_origin_regex` для поддержки всех `*.vercel.app` preview deployments
- Добавлен флаг `cors_allow_all_vercel` для контроля этой функции

## Тестирование

### Бонусы
- [ ] После 2 обычных еды появляется звёздочка
- [ ] После 4 обычных еды появляется звёздочка
- [ ] Звёздочка работает как раньше (5 сек +5 очков, затем 5 сек мигание +3 очка)
- [ ] Счётчик сбрасывается при новой игре

### Лидерборд
- [ ] Страница лидерборда открывается без ошибок
- [ ] После игры результат сохраняется
- [ ] Результат появляется в таблице лидеров
- [ ] При обновлении страницы результаты не пропадают

## Деплой

```bash
# Frontend
cd frontend && npm run build && npx vercel --prod

# Backend (автодеплой через git push)
git add . && git commit -m "hotfix: bonus frequency + leaderboard CORS" && git push
```
